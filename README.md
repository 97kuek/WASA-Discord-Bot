# WASA Discord Bot

富士川滑空場におけるTFの実施判断や、各種活動の管理を自動で行うDiscord Botです。

## コマンド一覧

`/help` を実行すると、Botが利用できるコマンドの詳細な一覧が表示されます。

### 主なコマンド
- `/help`
  - Botが利用可能なすべてのコマンド一覧を表示します。
- `/check_tf`
  - 富士川滑空場のTF実施可否を判定します。
- `/countdown <subcommand>`
  - `show`: すべてのカウントダウンを表示します。
  - `list`: 設定されているすべての目標を一覧表示します。
  - `add`: 新しいカウントダウン目標を追加します。
  - `remove`: IDを指定して目標を削除します。
- `/worklog <subcommand>`
  - `summary`: 週/月/全期間の作業時間を集計して表示します。
- `/setting <subcommand>` (管理者のみ)
  - `notifications`: 定時通知を送信するチャンネルを設定します。
  - `worklog_channel`: 作業記録を行うチャンネルを設定します。
  - `roles_panel`: 班のロールを選択するためのパネルを設置します。

## 主な機能

### 作業時間記録機能
特定のチャンネルで「あけた」「しめた」と発言することで、作業時間を記録できます。
1. 管理者が `/setting worklog_channel` コマンドで、記録を取りたいチャンネルを指定します。
2. メンバーが作業開始時にそのチャンネルで「あけた」と発言します。
3. 作業終了時に「しめた」と発言します。
4. Botが自動的に作業時間を計算し、記録します。記録されたデータは `/worklog` コマンドで確認できます。

**注意**: この機能を利用するには、Botに `GuildMessages` と `MessageContent` のIntentsが付与されている必要があります。

### ロール自動付与機能
`/setting roles_panel` コマンドを実行すると、ロール選択パネルが投稿されます。メンバーはボタンを押すだけで自分の班のロールを取得・解除できます。
**注意**: この機能を利用するには、Botに「ロールの管理」権限が付与されている必要があります。

### 天候判定のロジック
- 横風1m/s以下，風速2m/s以下
- 組み立て中・TF中に雨が降らない

$$V_{cross} = | V_{wind} \times \sin(\theta_{wind} - \theta_{runway}) |$$

## システム構成
- `index.js`: ボットの心臓部。起動、コマンド登録、インタラクション処理、定時実行（cron）を管理。
- `commands/`: 各スラッシュコマンドの実行ロジック。
- `utils/`: 
  - `weather.js`: 気象API通信と**横風計算**の物理ロジック。
  - `configManager.js`: 設定（通知チャンネル、複数の目標日など）の読み書き。
  - `countdown.js`: 日付計算ロジック。
  - `worklogManager.js`: 作業時間の記録・集計ロジック。

## 設定ファイル (`config.json`)
Botの設定はプロジェクトルートの`config.json`に保存されます。
```json
{
  "notifyChannelId": "123456789012345678",
  "workChannelId": "876543210987654321",
  "countdownTargets": [
    {
      "id": 1678886400000,
      "name": "鳥人間コンテスト",
      "date": "2026-07-25"
    }
  ]
}
```

## スケジュール機能
`node-cron` を利用し、以下のスケジュールで自動投稿を行います。
1. **07:00**: TF実施判定
2. **08:00**: 設定されているすべての目標へのカウントダウン