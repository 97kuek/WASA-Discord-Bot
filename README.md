# WASA Discord Bot

富士川滑空場にけるTFの実施判断と目標日までのカウントダウンを自動で行うDiscord Botです．あくまでも勉強目的なので，実際には運用をしません．

## システム構成

以下のように**モジュール化**を行っています．

- `index.js`: ボットの心臓部。起動、コマンド登録、定時実行（cron）を管理。
- `commands/`: 各スラッシュコマンド（`/check_tf`等）の実行ロジック。
- `utils/`: 
  - `weather.js`: 気象API通信と**横風計算**の物理ロジック。
  - `configManager.js`: 設定（目標日）の読み書き（永続化）。
  - `countdown.js`: 日付計算ロジック。

## 天候判定のロジック

TFの実施判断は以下の基準で定めています．
- 組み立て中・TF中に雨が降らない，または許容範囲内である
- 横風1m/s以下，風速2m/s以下

本ボットは OpenWeatherMap API から取得した予報値を、以下の物理計算に基づいて判定しています。

### 1. 横風（Crosswind）成分の分解
一般の天気予報の風速だけでは、滑走路に対して垂直な風（機体が流される風）がわかりません。以下の式を用いて横風成分を算出しています。

$$V_{cross} = | V_{wind} \times \sin(\theta_{wind} - \theta_{runway}) |$$

- 富士川滑空場の滑走路方位 ($\theta_{runway}$): 160°
- 判定基準: 横風 1.0m/s 以下

### 2. 判定しきい値
TF実施の可否は、早朝（0時〜9時）の予報が以下の条件を**すべて**満たすかどうかで決定されます。
- 一般風速: 2.0m/s 以下
- 横風成分: 1.0m/s 以下
- 降水量: 0.1mm 以下

## スケジュール機能

`node-cron` を利用し、以下のスケジュールで自動投稿を行います。
1. **07:00**: TF実施判定
2. **08:00**: チーム目標へのカウントダウン

## 学んだこと

### 環境変数の管理 (`.env`)
セキュリティのため、Discord TokenやAPI Keyはソースコードに直接書かず、`.env` ファイルで管理しています。`process.env` を通じて呼び出します。

### 非同期処理 (`async / await`)
API通信やDiscordへの送信など、完了まで時間がかかる処理において、プログラムの実行順序を制御するために使用しています。